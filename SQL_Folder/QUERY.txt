-- GROUP BY GEOGRAPHIC AREA
select DISTINCT DB040 AS AREA, COUNT(*) from TD_UDB_cIT23D
GROUP BY DB040;


-- GENERAL INFORMATION IN R DATASET TO CALCULATE WEIGHTS, THE SAMPLE CONSISTS IN NORTH-WEST AREA AND HIGH DENSITY AREA
SELECT  RB030 AS ID, 
        CASE WHEN RB090 = 1 THEN 'MALE' ELSE 'FEMALE' END AS SEX, -- CALCULATE WEIGHTS FOR SEX
        2023 - RB080 AS AGE, -- CALCULATE WEIGHTS FOR THE AGE CLASS
        SUBSTR(RB030,1,8) AS FAMILY_ID -- ASSIGN WEIGHTS FOR NUMBER OF COMPONENTS FROM H DATASET
FROM td_udb_cit23r
WHERE SUBSTR(RB030,1,8) IN (
                select DB030 from TD_UDB_cIT23D
                where DB040 = 'ITC' AND DB100 = 1
                );


-- TOTAL NUMBER OF MALE AND FEMALE IN THE NORTH-WEST AREA OF ITALY (ITC) AND HIGH DENSITY AREA (DB100 = 1)
SELECT DISTINCT CASE WHEN RB090 = 1 THEN 'MALE' ELSE 'FEMALE' END AS SEX, COUNT(*) AS TOTAL FROM TD_UDB_cIT23R
WHERE SUBSTR(RB030,1,8) IN (
                select DB030 from TD_UDB_cIT23D
                where DB040 = 'ITC' AND DB100 = 1
                )
GROUP BY RB090;


-- DISTRIBUTION OF AGES IN THE SAMPLE
SELECT 2023 - RB080 AS AGE, COUNT(*) AS TOTAL FROM TD_UDB_cIT23R
WHERE SUBSTR(RB030,1,8) IN (
                select DB030 from TD_UDB_cIT23D
                where DB040 = 'ITC' AND DB100 = 1
                )
GROUP BY RB080
ORDER BY RB080 DESC;