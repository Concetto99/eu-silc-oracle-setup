CREATE OR REPLACE VIEW VW_DATASET_CHILDREN_ANALYSIS_PARENTS AS
WITH CHILD_ANALYSIS AS (
select 
RB030 AS ID_CHILD,
HB030 AS ID_HOUSEHOLD,
RB090 AS SEX, -- 2 FEMALE 1 MALE 
2023 - RB080 AS AGE, -- AGE IN YEARS
RB220 AS FATHER_ID,
RB230 AS MOTHER_ID
from td_udb_cit23r R
LEFT OUTER JOIN td_udb_cit23h H
ON SUBSTR(R.RB030,1,8) = H.HB030
WHERE SUBSTR(RB030,1,8) IN (
                select DB030 from TD_UDB_cIT23D
                where DB040 = 'ITC' AND DB100 = 1
                )              
AND 2023 - RB080 <= 6
),
PARENTS AS (
SELECT
     RB030 AS PARENT_ID
    ,PL060 AS WORK_HOUR	--NUMBER OF HOURS USUALLY WORKED PER WEEK IN THE MAIN JOB Personal Data (P-file)
    ,PL051A	AS OCCUPATION --OCCUPATION IN MAIN JOB55 Personal Data (P-file)
    ,PL040A	AS EMPLOYMENT_STATUS --STATUS IN EMPLOYMENT (MAIN JOB) Personal Data (P-file)
FROM td_udb_cit23r R
LEFT JOIN
td_udb_cit23p P
ON R.RB030 = P.PB030
WHERE RB030 IN (
                SELECT FATHER_ID FROM CHILD_ANALYSIS
                UNION
                SELECT MOTHER_ID FROM CHILD_ANALYSIS
                )
)
SELECT PARENT_ID
    ,WORK_HOUR	--NUMBER OF HOURS USUALLY WORKED PER WEEK IN THE MAIN JOB Personal Data (P-file)
    ,OCCUPATION --OCCUPATION IN MAIN JOB55 Personal Data (P-file)
    ,EMPLOYMENT_STATUS --STATUS IN EMPLOYMENT (MAIN JOB) Personal Data (P-file)
FROM PARENTS;